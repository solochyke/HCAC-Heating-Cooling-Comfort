"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[23163],{272761:function(e,t,s){s.d(t,{k:function(){return a}});var n=s(777460),o=s(233475),i=JSON.parse('{"container":{"elementType":"div"},"cms-richtext":{"elementType":"div"},"text":{"elementType":"span"},"image":{"elementType":"img","attrs":{"src":{"type":"dynamic","content":{"referenceType":"attr","id":"url"}}},"selfClosing":true},"textinput":{"elementType":"input","attrs":{"type":{"type":"static","content":"text"}},"selfClosing":true},"passwordinput":{"elementType":"input","attrs":{"type":{"type":"static","content":"password"}},"selfClosing":true},"checkbox":{"elementType":"input","attrs":{"type":{"type":"static","content":"checkbox"}},"selfClosing":true},"radiobutton":{"elementType":"input","attrs":{"type":{"type":"static","content":"radio"}},"selfClosing":true},"textarea":{"elementType":"textarea"},"link":{"elementType":"a","attrs":{"href":{"type":"dynamic","content":{"referenceType":"attr","id":"url"}}}},"navlink":{"elementType":"a"},"form":{"elementType":"form","attrs":{"method":{"type":"dynamic","content":{"referenceType":"attr","id":"type"}},"action":{"type":"dynamic","content":{"referenceType":"attr","id":"url"}}}},"dropdown":{"elementType":"select","children":[{"type":"repeat","content":{"node":{"type":"element","content":{"type":"option","name":"option","children":[{"type":"dynamic","content":{"referenceType":"local","id":"item"}}]}},"dataSource":{"type":"dynamic","content":{"referenceType":"attr","id":"options"}},"meta":{"useIndex":true}}}]},"video":{"elementType":"video"},"audio":{"elementType":"audio"},"icon":{"elementType":"svg"},"path":{"elementType":"path"},"separator":{"elementType":"hr"},"linebreak":{"elementType":"br"},"cms-collection-list-repeater-node":{"elementType":"div"}}');function r(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function d(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?r(Object(s),!0).forEach((function(t){(0,n.Z)(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):r(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}const a=(e,t="stage")=>{if(e.primitiveType===o.sO.COMPONENT)return null;const{semanticType:s,primitiveType:n}=e,r=s||n;let a=i;"stage"===t&&(a=d(d({},a),l));const c=a[r],p="styles"in e?e.styles:{};return{elementType:(null===c||void 0===c?void 0:c.elementType)||r,attrs:d(d({},null===c||void 0===c?void 0:c.attrs),"attrs"in e?e.attrs:{}),styles:d(d({},null===c||void 0===c?void 0:c.style),p)}},l={button:{elementType:"button",style:{display:"flex",alignItems:"center",justifyContent:"center"}},link:{elementType:"span"},navlink:{elementType:"span"},textarea:{elementType:"textarea",attrs:{readonly:{type:"static",content:"true"}},selfClosing:!0},textinput:{elementType:"input",attrs:{type:{type:"static",content:"text"},readonly:{type:"static",content:"true"}}},radiobutton:{elementType:"input",attrs:{type:{type:"static",content:"radio"}}},checkbox:{elementType:"input",attrs:{type:{type:"static",content:"checkbox"}}}}},123163:function(e,t,s){s.d(t,{o:function(){return q}});var n,o,i,r,d,a,l,c,p,y,h,u,g,S,m,f,b,v=s(503348),I=s(777460),j=s(918437),T=s(395942),M=s(302503),N=s(694829),F=s(666505),w=s(523689),C=s(641673),D=s(649182),L=s(761328),O=s(298357),E=s.n(O),k=s(272761),x=s(633958),R=s.n(x),B=s(910034),$=s(233475),A=s(616776),P=s(301265);function U(e,t){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),s.push.apply(s,n)}return s}function H(e){for(var t=1;t<arguments.length;t++){var s=null!=arguments[t]?arguments[t]:{};t%2?U(Object(s),!0).forEach((function(t){(0,I.Z)(e,t,s[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):U(Object(s)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(s,t))}))}return e}let q=(n=(0,M.inject)("projectDoc"),o=(0,M.inject)("projectUIState"),i=(0,M.inject)("nodeStyleManagmentFlow"),r=(0,M.inject)("componentStyleManagementFlow"),d=(0,M.inject)("projectClassManagementFlow"),a=(0,M.inject)("elementRefProvider"),l=(0,M.inject)("nodeSelectionFlow"),c=(0,M.inject)("tailwindService"),p=class{constructor(){(0,I.Z)(this,"nodeStyleMap",{}),(0,I.Z)(this,"fontsListMap",{}),(0,I.Z)(this,"styleRootNode",null),(0,I.Z)(this,"rootHead",null),(0,I.Z)(this,"renderingMode","stage"),(0,I.Z)(this,"rootNode",null),(0,I.Z)(this,"nodeIdsWithStates",null),(0,I.Z)(this,"isInlinePreview",!1),(0,I.Z)(this,"unsubs",[]),(0,I.Z)(this,"tailwindSubs",[]),(0,v.Z)(this,"projectDoc",y,this),(0,v.Z)(this,"projectUIState",h,this),(0,v.Z)(this,"nodeStyleManagmentFlow",u,this),(0,v.Z)(this,"componentStyleManagementFlow",g,this),(0,v.Z)(this,"projectClassManagementFlow",S,this),(0,v.Z)(this,"elementRefProvider",m,this),(0,v.Z)(this,"nodeSelectionFlow",f,this),(0,v.Z)(this,"tailwindService",b,this),(0,I.Z)(this,"resetTailwindSubs",(()=>{this.tailwindSubs.forEach((e=>e())),this.tailwindSubs=[]})),this.nodeStyleMap.root={}}async init(e){if(this.styleRootNode=e.styleRootNode,this.rootHead=e.rootHead,this.renderingMode=e.renderingMode,this.rootNode=e.rootNode,this.isInlinePreview=e.isInlinePreview,this.setDefaultStyles=E()(this.setDefaultStyles,250),this.subscribeForStyleChanges(),this.subscribeForInteractionStateChange(),this.subscribeForDesignLanguageChanges(),this.setDefaultStyles(),this.subscribeForFontsChange(),this.subscribeForTokensAndNodesUsage(),this.subscribeForKybSpacePressed(),this.subscribeForBgTokenChange(),this.subscribeForClassChanges(),this.subscribeForBreakpointChange(),this.subscribeForDevStylesChange(),this.subscribeForMediaQueryUpdates(),this.subscribeForComponentStyleSetChanges(),this.subscribeForAssetOptimisationChanges(),this.subscribeForNodeChangesToCanvas(),this.rootHead){const e=this.projectDoc.fonts.byId,t=document.createDocumentFragment();this.rootHead.append(t),this.addQuillCustomFontStyles(e),Object.values(e||{}).forEach((e=>{const{usedInNodes:t={},usedInTokens:s={},usedInClasses:n={}}=e;0===Object.keys(t||{}).length&&0===Object.keys(s||{}).length&&0===Object.keys(n||{}).length||this.appendFont(e)})),this.addExternalStyleSheets()}this.computeRootStyles()}computeRootStyles(){this.addQuillStyles(),this.addRootBackground(),this.addDevStyles()}addExternalStyleSheets(){if(!this.rootHead)return;const e={animateCSS:{path:A.GS,preview:!0,design:!0},customScripts:{path:"https://unpkg.com/@teleporthq/teleport-custom-scripts/dist/style.css",preview:!0,design:!0},animateOnReveal:{path:"https://unpkg.com/@teleporthq/react-components/dist/style.css",preview:!1,design:!0}};let t=[];Object.values(e).forEach((e=>{e.design&&t.push(e.path)})),"preview"===this.renderingMode&&(t=[],Object.values(e).filter((e=>{e.preview&&t.push(e.path)}))),t.forEach((e=>{var t;const s=document.createElement("link");Object.assign(s,{href:e,rel:"stylesheet"}),null===(t=this.rootHead)||void 0===t||t.append(s)}))}addQuillStyles(){var e;if(!this.styleRootNode)return;this.nodeStyleMap.root.quillStyles&&(this.nodeStyleMap.root.quillStyles.remove(),delete this.nodeStyleMap.root.quillStyles);const t=B.Lx.map((e=>`.ql-font-${e.replace(/\s+/g,"-").toLowerCase()} { font-family: "${e}"; }`)),s=document.createElement("style");s.innerHTML=`\n      .ql-container { font-size: inherit !important }\n      .ql-editor { padding: 0; font-family: inherit !important; }\n       strong { font-weight: bolder; }\n       ${t.join("\n")}`,Object.assign(s.dataset,{reference:"quill-styles"}),this.nodeStyleMap.root.quillStyles=s,this.styleRootNode.appendChild(s),null===(e=this.rootHead)||void 0===e||e.append(s)}addQuillCustomFontStyles(e){var t;if(!this.styleRootNode)return;this.nodeStyleMap.root.quillFontStyles&&(this.nodeStyleMap.root.quillFontStyles.remove(),delete this.nodeStyleMap.root.quillFontStyles);const s=document.createElement("style");Object.values(e).forEach((e=>{const t=e.name.replace(/\s+/g,"-").toLowerCase();s.innerHTML=`${s.innerHTML}\n        .ql-font-${t} { font-family: "${e.name}"; }\n      `})),Object.assign(s.dataset,{reference:"quill-font-styles"}),this.nodeStyleMap.root.quillFontStyles=s,this.styleRootNode.appendChild(s),null===(t=this.rootHead)||void 0===t||t.append(s)}async generateTailwindStyles(){if(!this.rootNode)return;const e=await this.tailwindService.getStyleSheet(this.rootNode.innerHTML);e&&this.appendTailwindStyles(e)}addRootBackground(){var e;if(!this.styleRootNode||this.projectUIState.userInteractions.isNodeInPreviewMode)return;this.nodeStyleMap.root.rootNodeBg&&(this.nodeStyleMap.root.rootNodeBg.remove(),delete this.nodeStyleMap.root.rootNodeBg);const t=(null===(e=this.projectDoc.designLanguage.getTokenWithRole("background-color"))||void 0===e?void 0:e.value)||"white",s=document.createElement("style"),{componentId:n}=this.projectUIState.selection;if(n&&this.projectDoc.components.byId[n]){var o;const e=this.nodeStyleManagmentFlow.getCurrentStyleValueByKeyForNode((null===(o=this.projectDoc.components.byId[n])||void 0===o?void 0:o.rootNodeId)||"",["backgroundColor","backgroundImage","background"]);(e.backgroundColor||e.backgroundImage)&&e.background&&"transparent"!==e.backgroundColor||(s.innerHTML="body > div> *  {\n          border-color: #118eff;\n          border-width: 1px;\n          border-style: dashed;\n        }")}else s.innerHTML=`body > div> *  {\n        background: ${t};\n      }`;s.innerHTML+=`\n      body:hover #${P.c.STAGE.ADD_SECTION}, body:hover #${P.c.STAGE.GENERATE_PAGE} {\n        opacity: 1;\n        background: ${t};\n        color: ${(0,C.lF)(t)};\n      }\n      #${P.c.STAGE.ADD_SECTION}, #${P.c.STAGE.GENERATE_PAGE} {\n        opacity: 0;\n        transition: opacity 0.3s ease-in-out;\n      }\n    `,this.nodeStyleMap.root.rootNodeBg=s,this.styleRootNode.appendChild(s)}addDevStyles(){var e;const t=this.projectUIState.devMode.devStyles;if(!this.styleRootNode||!Object.keys(null!==t&&void 0!==t?t:{}).length)return;this.nodeStyleMap.root.devStyles&&(this.nodeStyleMap.root.devStyles.remove(),delete this.nodeStyleMap.root.devStyles);const s=Object.values(t).join(""),n=document.createElement("style");n.innerHTML=s,this.nodeStyleMap.root.devStyles=n,this.styleRootNode.appendChild(n),null===(e=this.rootHead)||void 0===e||e.append(n)}subscribeForNodeChangesToCanvas(){const e=e=>{var t,s;const n=Number(null!==(t=e.dataset.slideIndex)&&void 0!==t?t:"0"),o=null===e||void 0===e||null===(s=e.parentNode)||void 0===s?void 0:s.querySelector('[data-thq="slider-pagination"]');o&&o.childNodes.forEach(((e,t)=>{e instanceof HTMLElement&&(t===n?e.classList.add("swiper-pagination-bullet-active"):e.classList.remove("swiper-pagination-bullet-active"))}))},t=(e,t)=>{const s=e.parentNode;if(!s||!(s instanceof HTMLElement))return;const n=Array.from(s.childNodes).filter((e=>e instanceof HTMLElement)),o=n.find((e=>"slider-button-prev"===e.dataset.thq)),i=n.find((e=>"slider-button-next"===e.dataset.thq));i&&o&&(t>1?(o.style.visibility="visible",i.style.visibility="visible"):(o.style.visibility="hidden",i.style.visibility="hidden"))},s=this.elementRefProvider.getIframeRoot();if(!s)return;const n=new MutationObserver((s=>{s.forEach((s=>{const{target:n,addedNodes:o,type:i,attributeName:r,removedNodes:d}=s;if(n instanceof HTMLElement){if("slider-wrapper"===n.dataset.thq&&1===o.length&&o[0]instanceof HTMLElement&&"slider-slide"===o[0].dataset.thq&&t(n,n.childNodes.length),"slider-wrapper"===n.dataset.thq&&1===d.length&&d[0]instanceof HTMLElement&&"slider-slide"===d[0].dataset.thq&&t(n,n.childNodes.length),"attributes"===i&&"data-slide-index"===r&&"slider-wrapper"===n.dataset.thq){e(n);const t=setTimeout((()=>{(0,T.mutate)(this.projectUIState,(e=>e.selection.forceRenderSelection=Date.now()))}),600);this.unsubs.push((()=>clearTimeout(t)))}"childList"===i&&"slider-pagination"===n.dataset.thq&&o.length>0&&e(n.previousSibling)}}))})),o=new ResizeObserver((()=>{const e=s.querySelectorAll("[data-thq='slider-wrapper']");0!=e.length&&(e.forEach((e=>{var t;const s=Number(null!==(t=e.dataset.slideIndex)&&void 0!==t?t:"0"),n=s>0?-s:0;Object.assign(e.style,{transition:"transform 0ms ease-in-out 0ms",transform:`translate3d(${n*e.offsetWidth}px, 0, 0)`})})),(0,T.mutate)(this.projectUIState,(e=>e.selection.forceRenderSelection=Date.now())))}));o.observe(s),n.observe(s,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["data-slide-index"]}),this.unsubs.push((()=>n.disconnect()),(()=>o.disconnect()))}subscribeForDevStylesChange(){const e=(0,T.select)(this.projectUIState,["devMode/devStyles","devMode/devStyles/*"],(()=>{this.addDevStyles()}),"DevStyleChange");this.unsubs.push((()=>e.dispose()))}subscribeForBreakpointChange(){const e=(0,T.select)(this.projectUIState,["stage/matchedBreakpoint"],(()=>{this.addRootBackground()}),"UIDLStyleSheetManager10");this.unsubs.push((()=>e.dispose()))}subscribeForKybSpacePressed(){const e=(0,T.select)(this.projectUIState,["userInteractions/pressedKeys/space"],((e,t)=>{if(this.projectUIState.drag.draggedEntity)return;const{op:s}=t[0];"add"!==s?"remove"===s&&this.nodeStyleMap.root.cursor&&this.nodeStyleMap.root.cursor.remove():this.appendCursorStyle()}),"UIDLStyleSheetManager1");this.unsubs.push((()=>e.dispose()))}subscribeForFontsChange(){const e=(0,T.select)(this.projectDoc,["fonts/byId/*"],((e,t)=>{t.forEach((e=>{const{op:t,value:s,pathArray:n,old:o}=e;if("add"===t&&3===n.length&&"fonts"===n[0]&&this.appendFont(s),"remove"===t&&3===n.length&&"fonts"===n[0]){const{id:e}=o;this.removeFontFromHead(e)}})),this.addQuillCustomFontStyles(e.fonts.byId)}),"UIDLStyleSheetManager2");this.unsubs.push((()=>e.dispose()))}subscribeForStyleChanges(){this.projectUIState.userPreferences.layoutStructureVisible&&this.appendLayoutStyleNode();const e=(0,T.select)(this.projectDoc,["nodes/byId/*/styles","nodes/byId/*/styles/*","nodes/byId/*/styles/*/disabled","nodes/byId/*/styles/*/content","nodes/byId/*/referencedStyles","nodes/byId/*/referencedStyles/*","nodes/byId/*/referencedStyles/*/content/styles","nodes/byId/*/referencedStyles/*/content/styles/*","nodes/byId/*/referencedStyles/*/content/styles/*/disabled","nodes/byId/*/referencedStyles/*/content/styles/*/content"],((e,t)=>{t.forEach((t=>{var s;const{pathArray:n,op:o,value:i,old:r}=t,{componentId:d}=this.projectUIState.selection,a=(null===(s=this.projectDoc.components.byId[d||""])||void 0===s?void 0:s.rootNodeId)||"";if("nodes"!==n[0])return;const l=n[2],c=e.nodes.getSlotAndCompInstanceIdForNodeById(l).compInstanceId||"root";if(l===a&&this.addRootBackground(),"styles"!==n[3])if("referencedStyles"!==n[3]||"styles"!==n[6])if("referencedStyles"!==n[3]||5!==n.length){if("referencedStyles"===n[3]&&"replace"===o){if(!this.rootNode)return;const t=this.rootNode.querySelectorAll(`[data-node-id="${n[2]}"]`);Object.values(r||{}).forEach((s=>{if("project-referenced"===s.content.mapType){const n=e.classes.byId[s.content.referenceId];n&&(null===t||void 0===t||t.forEach((t=>{null===t||void 0===t||t.classList.remove(n.getIdentifier(e.classes.byId))})))}if("design-language-referenced"===s.content.mapType){const n=s.content.referenceId;if(!e.designLanguage.textStyleSetsById[n])return;null===t||void 0===t||t.forEach((t=>{this.removeTextStyleFromNode(t,e)}))}Object.values(i||{}).forEach((s=>{if("project-referenced"===s.content.mapType){const n=e.classes.byId[s.content.referenceId];n.linkedTextStyles&&Object.keys(n.linkedTextStyles).forEach((s=>{const n=e.designLanguage.textStyleSetsById[s];null===t||void 0===t||t.forEach((t=>{this.removeTextStyleFromNode(t,e),null===t||void 0===t||t.classList.add(n.identifier)}))})),null===t||void 0===t||t.forEach((t=>{null===t||void 0===t||t.classList.add(n.getIdentifier(e.classes.byId))}))}}));const n=Object.values(i||{}).find((e=>"design-language-referenced"===e.content.mapType));if(n){const s=n.content.referenceId,o=e.designLanguage.textStyleSetsById[s];if(!o)return;null===t||void 0===t||t.forEach((t=>{this.removeTextStyleFromNode(t,e),null===t||void 0===t||t.classList.add(o.identifier)}))}this.appendStyleForNodeId(l,c)}))}}else{if("inlined"===(null===i||void 0===i?void 0:i.content.mapType)||"inlined"===(null===r||void 0===r?void 0:r.content.mapType))return void this.appendStyleForNodeId(l,c);if("add"===o&&"design-language-referenced"===(null===i||void 0===i?void 0:i.content.mapType)){const t=i.content.referenceId,s=e.designLanguage.textStyleSetsById[t];if(!s||!this.rootNode)return;this.rootNode.querySelectorAll(`[data-node-id="${n[2]}"]`).forEach((t=>{this.removeTextStyleFromNode(t,e),null===t||void 0===t||t.classList.add(s.identifier)}))}if("remove"===o&&"design-language-referenced"===(null===r||void 0===r?void 0:r.content.mapType)){const t=r.content.referenceId;if(!e.designLanguage.textStyleSetsById[t]||!this.rootNode)return;const s=this.rootNode.querySelectorAll(`[data-node-id="${n[2]}"]`);null===s||void 0===s||s.forEach((t=>{this.removeTextStyleFromNode(t,e)}))}if("project-referenced"===(null===i||void 0===i?void 0:i.content.mapType)||"project-referenced"===(null===r||void 0===r?void 0:r.content.mapType)){var p;const t=null===(p=this.rootNode)||void 0===p?void 0:p.querySelectorAll(`[data-node-id="${n[2]}"]`),s=e.classes.byId[n[4]];if("add"===o&&(null!==s&&void 0!==s&&s.linkedTextStyles&&Object.keys(s.linkedTextStyles).forEach((s=>{const n=e.designLanguage.textStyleSetsById[s];null===t||void 0===t||t.forEach((e=>{null===e||void 0===e||e.classList.add(n.identifier)}))})),null===t||void 0===t||t.forEach((t=>{null===t||void 0===t||t.classList.add(s.getIdentifier(e.classes.byId))}))),"remove"===o){var y;const t=null===(y=this.rootNode)||void 0===y?void 0:y.querySelectorAll(`[data-node-id="${n[2]}"]`);s&&(null===t||void 0===t||t.forEach((t=>{null===t||void 0===t||t.classList.remove(s.getIdentifier(e.classes.byId))})))}}}else this.appendStyleForNodeId(l,c);else this.appendStyleForNodeId(l,c)}))}),"UIDLStyleSheetManager3"),t=(0,T.select)(this.projectUIState,["userPreferences/layoutStructureVisible"],((e,t)=>{const{op:s}=t[0];"add"!==s?"remove"===s&&this.nodeStyleMap.root.layout&&this.nodeStyleMap.root.layout.remove():this.appendLayoutStyleNode()}),"UIDLStyleSheetManager4"),s=(0,T.select)(this.projectUIState,["userPreferences/applyForegroundColorAsIconFill"],(e=>{const t=(0,N.w0)(this.projectDoc.designLanguage);this.appendCustomStyleSheet("project-style",`${(0,N.lf)(t,"stage"===this.renderingMode,e.userPreferences.applyForegroundColorAsIconFill)} \n ${this.extractTextStylesFromTokens(this.projectDoc.designLanguage.textStyleSetsById||{})}`)}),"UIDLStyleSheetManager5");this.unsubs.push((()=>e.dispose()),(()=>t.dispose()),(()=>s.dispose()))}subscribeForTokensAndNodesUsage(){const e=(0,T.select)(this.projectDoc,["fonts/byId/*/usedInTokens/*","fonts/byId/*/usedInNodes/*"],((e,t)=>{t.forEach((e=>{const{op:t,pathArray:s}=e;if("remove"===t&&"fonts"===s[0]&&5===s.length){const e=this.projectDoc.fonts.byId[s[2]];if(!e)return;const{usedInNodes:t={},usedInTokens:n={},id:o}=e;0===Object.keys(t).length&&0===Object.keys(n).length&&this.removeFontFromHead(o)}if("add"===t&&"fonts"===s[0]&&5===s.length){const e=this.projectDoc.fonts.byId[s[2]];e&&e.path&&"system"!==e.type&&this.appendFont(e)}}))}),"UIDLStyleSheetManager5");this.unsubs.push((()=>e.dispose()))}subscribeForDesignLanguageChanges(){const e=(0,T.select)(this.projectDoc,["designLanguage/categoriesById/*","designLanguage/categoriesById/**","designLanguage/tokensById/*","designLanguage/tokensById/**","designLanguage/textStyleSetsById/*","designLanguage/textStyleSetsById/**","designLanguage/categoriesById/*"],((e,t)=>{this.setDefaultStyles(),this.tailwindService.generateTailwindClassOptions(),t.forEach((t=>{const{op:s,pathArray:n}=t;if("replace"===s&&"tokensById"===n[1]&&("name"===n[3]||"type"===n[3])){const t=n[2],s=e.designLanguage.tokensById[t];if(!s)return;Object.keys(s.usedInNodes).forEach((e=>{this.appendStyleForNodeId(e)}))}if("replace"===s&&"categoriesById"===n[1]&&"name"===n[3]){const t=n[2];e.designLanguage.getTokensByCategoryId(t).forEach((e=>{Object.keys(e.usedInNodes).forEach((e=>{this.appendStyleForNodeId(e)}))}))}if("tokensById"===n[1]&&"value"===n[3]){if("background-color"!==e.designLanguage.tokensById[n[2]].role)return;this.computeRootStyles()}}))}),"UIDLStyleSheetManager6");this.unsubs.push((()=>e.dispose()))}subscribeForClassChanges(){const e=(0,T.select)(this.projectDoc,["classes/byId/**"],((e,t)=>{t.forEach((t=>{const{pathArray:s,op:n}=t;if("classes"===s[0]&&s.length>4&&"conditions"===s[3]){const t=e.classes.byId[s[2]];if(!t)return;const o=s[4];"add"===n&&"element-state"===t.conditions[o].type&&Object.keys("usedInNodes"in t&&t.usedInNodes||{}).forEach((e=>{this.appendStyleForNodeId(e)}))}})),this.appendCustomStyleSheet("project-classes",this.projectClassManagementFlow.getResolvedStylesForRendering(this.renderingMode))}),"UIDLStyleManagerClassSubscriber"),t=(0,T.select)(this.projectDoc,["classes/byId/*","classes/byId/*/usedInNodes/*"],((e,t)=>{t.forEach((t=>{const{pathArray:s,op:n}=t;if("classes"===s[0]&&"remove"===n&&5===s.length&&"usedInNodes"===s[3]){var o;const t=null===(o=this.rootNode)||void 0===o?void 0:o.querySelectorAll(`[data-node-id="${s[4]}"]`);null===t||void 0===t||t.forEach((t=>{null===t||void 0===t||t.classList.forEach((s=>{e.designLanguage.getTextStyleByIdentifier(s)||Object.values(e.classes.byId).some((t=>t.getIdentifier(e.classes.byId)===s))||null===t||void 0===t||t.classList.remove(s)}))}))}}))}),"UIDLStyleManagerClassSubscriber"),s=(0,T.select)(this.projectDoc,["classes/byId/*/disabledInNodes/*"],((e,t)=>{t.forEach((t=>{var s;const{pathArray:n,op:o}=t;if("classes"!==n[0]||n.length<4||"disabledInNodes"!==n[3])return;const i=null===(s=this.rootNode)||void 0===s?void 0:s.querySelectorAll(`[data-node-id="${n[4]}"]`);null===i||void 0===i||i.forEach((t=>{var s;const i=null===(s=e.classes.byId[n[2]])||void 0===s?void 0:s.getIdentifier(e.classes.byId);i&&("add"===o&&(null===t||void 0===t||t.classList.remove(i)),"remove"===o&&(null===t||void 0===t||t.classList.add(i)))}))}))}),"UIDLStyleManagerClassDisableSubscriber"),n=(0,T.select)(this.projectDoc,["classes/byId/*/linkedTextStyles/*"],((e,t)=>{t.forEach((t=>{const{pathArray:s,op:n}=t;if("classes"!==s[0]||"linkedTextStyles"!==s[3])return;const o=e.classes.byId[s[2]];if(!("usedInNodes"in o))return;const i=o.usedInNodes,r=e.designLanguage.textStyleSetsById[s[4]];Object.keys(i).forEach((t=>{if(!r||!this.rootNode)return;const s=this.rootNode.querySelectorAll(`[data-node-id="${t}"]`);null===s||void 0===s||s.forEach((t=>{"add"===n||"replace"===n?(this.removeTextStyleFromNode(t,e),null===t||void 0===t||t.classList.add(r.identifier)):this.removeTextStyleFromNode(t,e)}))}))}))}),"UIDLStyleManagerClassSubscriber");this.unsubs.push((()=>e.dispose()),(()=>n.dispose()),(()=>t.dispose()),(()=>s.dispose()))}subscribeForBgTokenChange(){const e=(0,T.select)(this.projectDoc,["designLanguage/tokensById/*/role"],(()=>{this.addRootBackground()}),"UIDLStyleSheetManager7");this.unsubs.push((()=>e.dispose()))}subscribeForMediaQueryUpdates(){const e=(0,T.select)(this.projectDoc,["mediaQueryBreakpoints/byId/*/maxWidth"],(async(e,t)=>{t.forEach((t=>{const{pathArray:s}=t;if("mediaQueryBreakpoints"!==s[0]||"maxWidth"!==s[3])return;const n=this.projectUIState.selection.componentId;if(!n)return;const o=e.getRootNodeIdForPageOrComponent(n);o&&e.nodes.bfs(o,(t=>{const s=e.nodes.getSlotAndCompInstanceIdForNodeById(t.id).compInstanceId||"root";this.appendStyleForNodeId(t.id,s)}))}))}),"UIDLStyleSheetManagerMQs");this.unsubs.push((()=>e.dispose()))}subscribeForInteractionStateChange(){const e=this.nodeSelectionFlow.getSelectedNodesIds(),t=(t,s)=>{if(!this.nodeIdsWithStates)return;let n=0;for(;n<this.nodeIdsWithStates.length;){const t=this.nodeIdsWithStates[n];let o=this.projectDoc.nodes.getNodeSubtreeIds(t);s||(o=o.filter((e=>e!==t)));e.some((e=>o.includes(e)))?n+=1:(this.appendStyleForNodeId(t),this.nodeIdsWithStates.splice(n,1))}},s=(0,T.select)(this.projectUIState,["stage/interactionState"],(e=>{if(t(0,!1),e.stage.interactionState.state){const t=this.projectDoc.classes.byId[e.stage.interactionState.classId||""],s="simple"===(null===t||void 0===t?void 0:t.classType)?Object.keys(t.usedInNodes):this.nodeSelectionFlow.getSelectedNodesIds(e);return this.nodeIdsWithStates=[...this.nodeIdsWithStates||[],...s],void s.forEach((e=>this.appendStyleForNodeId(e)))}this.nodeIdsWithStates}),"UIDLStyleSheetManager8"),n=(0,T.select)(this.projectUIState,["selection/nodes/*"],((e,s)=>{s.forEach((t=>{const{pathArray:s,op:n}=t;if("remove"===n&&3===s.length&&"selection"===s[0]){const e=this.projectDoc.nodes.getById(s[2]);if(!e)return;const t=this.projectDoc.tailwindCSS.getTailwindClassesForNode(s[2]);if(Object.keys(t||{}).length>0){const s=this.elementRefProvider.getDomNodeElementRefByCompInstance(e.id);null===s||void 0===s||s.removeAttribute("class"),null===s||void 0===s||s.classList.add(...(0,F.ux)({renderingMode:this.renderingMode,tailwind:t,referencedStyles:"referencedStyles"in e?null===e||void 0===e?void 0:e.referencedStyles:{},textStyleTokens:this.projectDoc.designLanguage.textStyleSetsById,cssClassesList:this.projectDoc.classes.byId,nodeId:e.id}))}}if("add"===n&&3===s.length&&"nodes"===s[1]){const t=this.nodeSelectionFlow.getSelectedNodesIds(e)[0];if(!t)return;const s=this.projectDoc.nodes.getById(t);if(!s||"element-node"!==(null===s||void 0===s?void 0:s.type))return;const n=null===s||void 0===s?void 0:s.attrs["data-thq"];if(n&&"static"===n.type&&s.primitiveType===$.IV.SLIDER_SLIDE){const e=this.projectDoc.nodes.getById(s.parentId);if(!e||"element-node"!==(null===e||void 0===e?void 0:e.type))return;const t=setTimeout((()=>{const t=this.elementRefProvider.getDomNodeElementRefByCompInstance(e.id),n=this.projectDoc.nodes.getChildren(e),o=this.projectDoc.nodes.orderChildrenIds(n).indexOf(s.id),i={transition:"transform 300ms ease-in-out 100ms",transform:`translate3d(${(o>0?-o:0)*t.offsetWidth}px, 0, 0)`};Object.assign(t.dataset,{slideIndex:o}),Object.assign(t.style,i)}),100);this.unsubs.push((()=>clearTimeout(t)))}}})),!e.stage.interactionState.state&&this.nodeIdsWithStates&&t(0,!0)}),"UIDLStyleSheetManager9");this.unsubs.push((()=>s.dispose()),(()=>n.dispose()))}subscribeForComponentStyleSetChanges(){const e=(0,T.select)(this.projectDoc,["components/byId/*/styleSetDefinitions/**"],((e,t)=>{t.forEach((t=>{const{pathArray:s}=t;if("components"!==s[0])return;const n=e.components.byId[s[2]],o=null===n||void 0===n?void 0:n.rootNodeId;if(!n||!o)return;const i=n.styleSetDefinitions[s[4]];Object.keys((null===i||void 0===i?void 0:i.usedByInstances)||{}).forEach((e=>{this.removeStyleForNode(o,e),this.appendStyleForNodeId(o,e)}))}))}),"CompStyleSetSub");this.unsubs.push((()=>e.dispose()))}subscribeForAssetOptimisationChanges(){const e=(0,T.select)(this.projectDoc,["assets/byId/*/sizePerComponent/*","assets/byId/*/sizePerComponent"],((e,t)=>{t.forEach((t=>{const{pathArray:s}=t;if(s.length<4||"assets"!==s[0]||"sizePerComponent"!==s[3])return;const n=e.assets.byId[s[2]];n&&Object.keys(n.usedInNodes).forEach((t=>{const s=e.nodes.getById(t);if((null===s||void 0===s?void 0:s.primitiveType)!==$.sO.COMPONENT&&(null===s||void 0===s?void 0:s.primitiveType)!==$.sO.VIDEO&&(null===s||void 0===s?void 0:s.primitiveType)!==$.sO.IMAGE)return this.removeStyleForNode(t),void this.appendStyleForNodeId(t)}))}))}),"StyleSheetOptimisationsSub");this.unsubs.push((()=>e.dispose()))}detach(){this.unsubs.forEach((e=>e())),this.unsubs=[],this.resetTailwindSubs()}extractTextStylesFromTokens(e){if(!e||0===Object.keys(e||{}).length)return"";const t=Object.values(e).sort(((e,t)=>e.position-t.position)).reduce(((e,t)=>(e[t.identifier]=(0,C.$e)(Object.keys(t.content||{}).reduce(((e,s)=>{var n;return e[s]=null===(n=t.content[s])||void 0===n?void 0:n.content,e}),{}),"stage"),e)),{});return(0,C.f7)(t)}setDefaultStyles(){var e;if(!this.styleRootNode)return;const t=(0,N.w0)(this.projectDoc.designLanguage);this.appendCustomStyleSheet("reset",(0,D.D)()),this.appendCustomStyleSheet("elements-style",(0,N.Vu)(t,!0)),this.appendCustomStyleSheet("project-style",`${(0,N.lf)(t,"stage"===this.renderingMode,this.projectUIState.userPreferences.applyForegroundColorAsIconFill)} \n ${this.extractTextStylesFromTokens(this.projectDoc.designLanguage.textStyleSetsById||{})}`),this.appendCustomStyleSheet("design-language",this.getDesignLanguageVariables()),this.appendCustomStyleSheet("project-classes",this.projectClassManagementFlow.getResolvedStylesForRendering(this.renderingMode)),this.appendCustomStyleSheet("utility-classes",(0,N.Uc)());const s=null===(e=this.projectDoc.settings.code)||void 0===e?void 0:e.headTag;"preview"===this.renderingMode&&s&&this.appendCustomStyleSheet("project-settings",this.resolveProjectSettingsHeadCustomCode(s)),"stage"===this.renderingMode&&this.appendCustomStyleSheet("disable-animations","* {\n          animation-duration: 0s !important;\n          animation-iteration-count: 0 !important;\n        }")}getDesignLanguageVariables(){const e=this.projectDoc.designLanguage.getTokensAsCustomProperties();return`:root {${Object.keys(e).map((t=>{const{name:s,value:n}=e[t];return`${s}: ${n};`})).join("\n")}}`}appendCursorStyle(){var e;const t=document.createElement("style");return t.innerHTML=F.b7,this.nodeStyleMap.root.cursor=t,null===(e=this.styleRootNode)||void 0===e||e.append(t),t}appendLayoutStyleNode(){var e;const t=document.createElement("style");return t.innerHTML=F.bZ,this.nodeStyleMap.root.layout=t,null===(e=this.styleRootNode)||void 0===e||e.append(t),t}appendCustomStyleSheet(e,t){if(this.styleRootNode)if(this.nodeStyleMap.root[e])this.nodeStyleMap.root[e].innerHTML=t;else{const s=document.createElement("style");s.dataset.reference=e,s.innerHTML=t,this.styleRootNode.append(s),this.nodeStyleMap.root[e]=s}}appendStyleForNodeId(e,t){t=t||"root";const s=this.projectDoc.nodes.getById(e);if(!s||!this.styleRootNode||s.primitiveType===$.sO.COMPONENT)return;const n=[];s.parentId||n.push(`div[data-node-id='${e}']:not([data-comp-instance-id]) {margin:0 !important;}`);const o="root"!==t?`[data-comp-instance-id='${t}']`:"",i=this.nodeStyleManagmentFlow.getResolvedStyles({nodeId:e,dynamicStyleResult:"variable",replaceAssetIdsWithSrcs:!0,ignoreDisabledNodes:"stage"===this.renderingMode}),r=(0,k.k)(s,this.renderingMode),d=(null===r||void 0===r?void 0:r.elementType)||"",{styles:a,referencedStyles:l}=this.componentStyleManagementFlow.getStylesInheritedFromComponentInstance(e,t),c=this.nodeStyleManagmentFlow.resolveStaticAndDynamicNodes({styles:a,dynamicStyleResult:"variable",replaceAssetIdsWithSrcs:!0,ignoreDisabledNodes:"stage"===this.renderingMode});n.push(`${d}[data-node-id='${e}']${o} {${(0,C.$e)(H(H({},i),c),this.renderingMode,this.isInlinePreview)}}`),"iframe"===d&&n.push(`div[data-node-id='${e}']${o} {${(0,C.$e)(H(H({},i),c),this.renderingMode,this.isInlinePreview)}}`),n.push(...this.getMediaQueryStyles(e,l,d,o));const p=this.getUIStatesStyles(e,d);if(p&&("string"===typeof p?n.push(p):n.push(...p)),this.nodeStyleMap[t]||(this.nodeStyleMap[t]={}),this.nodeStyleMap[t][e])this.nodeStyleMap[t][e].innerHTML=n.join("\n");else{const s=document.createElement("style");s.dataset.styleId=e,s.dataset.reference="inlined",s.innerHTML=n.join("\n"),this.nodeStyleMap[t][e]=s,this.styleRootNode.appendChild(s)}}getMediaQueryStyles(e,t,s,n){const o=[];return this.projectDoc.mediaQueryBreakpoints.getNonDefaultActiveMQBreakpointsInOrder().map((e=>e.maxWidth)).sort(((e,t)=>t-e)).forEach((i=>{const r=this.nodeStyleManagmentFlow.getResolvedInlineStyles({nodeId:e,condition:{conditionType:"screen-size",maxWidth:i},dynamicStyleResult:"variable",replaceAssetIdsWithSrcs:!0,ignoreDisabledNodes:"stage"===this.renderingMode}),d=Object.values(t).find((e=>"inlined"===e.content.mapType&&R()(e.content.conditions[0],{conditionType:"screen-size",maxWidth:i}))),a=this.nodeStyleManagmentFlow.resolveStaticAndDynamicNodes({styles:(null===d||void 0===d?void 0:d.content.styles)||{},dynamicStyleResult:"variable",replaceAssetIdsWithSrcs:!0,ignoreDisabledNodes:"stage"===this.renderingMode});o.push(`\n @media(max-width: ${i}px) { ${s}[data-node-id='${e}']${n} { ${(0,C.$e)(H(H({},r),a),this.renderingMode,this.isInlinePreview)} }}`)})),o}getUIStatesStyles(e,t){const s=this.projectDoc.nodes.getById(this.projectDoc.getOwnerIdOfDependentNode(e));if(s){if("preview"===this.renderingMode){return Object.keys(L.F).map((n=>{const o=this.nodeStyleManagmentFlow.getResolvedInlineStyles({nodeId:e,condition:{conditionType:"element-state",content:n},dynamicStyleResult:"variable",replaceAssetIdsWithSrcs:!0,ignoreDisabledNodes:"stage"===this.renderingMode});let i=t;var r;if(Object.keys(o).length)return"abilities"in s&&null!==(r=s.abilities)&&void 0!==r&&r.link&&["visited","link"].includes(n)&&(i="a"),`${i}[data-node-id='${e}']:${n} {${(0,C.$e)(o,this.renderingMode,this.isInlinePreview)}}`})).filter((e=>e))}{const s=this.projectUIState.stage.interactionState,n=s.state;if(!n)return;const o=this.projectDoc.classes.byId[s.classId||""];if(o&&"simple"!==o.classType)throw new Error("Attempted to disable state, but state class is compound!");if((o?Object.keys((null===o||void 0===o?void 0:o.usedInNodes)||{}):this.nodeSelectionFlow.getSelectedNodesIds()).includes(e)){const s=this.nodeStyleManagmentFlow.getResolvedInlineStyles({nodeId:e,condition:{conditionType:"element-state",content:n},dynamicStyleResult:"variable",replaceAssetIdsWithSrcs:!0,ignoreDisabledNodes:"stage"===this.renderingMode}),o=this.projectClassManagementFlow.getResolvedInteractionStateForClasses(this.projectClassManagementFlow.getClassesUsedByNodes([e]));return`${t}[data-node-id='${e}'] {${(0,C.$e)(H(H({},o),s),this.renderingMode,this.isInlinePreview)}}`}}}}appendTailwindStyles(e){var t;const s=this.nodeStyleMap.root["tailwind-style"];if(s)return void(s.innerHTML=e);const n=document.createElement("style");n.dataset.reference="tailwind-style",n.innerHTML=e;const o=this.nodeStyleMap.root["design-language"];o&&this.styleRootNode&&(null===(t=o.parentElement)||void 0===t||t.insertBefore(n,o.previousSibling),this.nodeStyleMap.root["tailwind-style"]=n)}resolveTokenValue(e){var t;const s=null===(t=this.projectDoc.designLanguage.getTokensAsCustomProperties()[e.content.id])||void 0===t?void 0:t.name;return new w.F({content:`var(${s})`})}appendFont(e){const{id:t,path:s,type:n}=e;if(!this.fontsListMap[t]&&this.rootHead&&"system"!==n){if("google"===n){const e=document.createElement("link");Object.assign(e,{href:s,rel:"stylesheet"}),Object.assign(e.dataset,{fontId:t}),this.rootHead.append(e),this.fontsListMap[t]=e}if("custom"===n){if(e.properties){const t=document.createElement("style");return t.innerHTML=e.toFontDecleration()||"",Object.assign(t.dataset,{fontId:e.id}),this.rootHead.append(t),void(this.fontsListMap[e.id]=t)}const n=document.createElement("link");Object.assign(n,{href:s,rel:"stylesheet"}),Object.assign(n.dataset,{fontId:t}),this.rootHead.append(n),this.fontsListMap[t]=n}}}removeFontFromHead(e){this.fontsListMap[e]&&(this.fontsListMap[e].remove(),delete this.fontsListMap[e])}removeStyleForNode(e,t){t=t||"root",this.styleRootNode&&this.nodeStyleMap[t]&&this.nodeStyleMap[t][e]&&(this.nodeStyleMap[t][e].remove(),delete this.nodeStyleMap[t][e])}removeTextStyleFromNode(e,t){null===e||void 0===e||e.classList.forEach((s=>{t.designLanguage.getTextStyleByIdentifier(s)&&(null===e||void 0===e||e.classList.remove(s))}))}resolveProjectSettingsHeadCustomCode(e){const t=(new DOMParser).parseFromString(e,"text/html");return Array.from(t.getElementsByTagName("style")).map((e=>e.innerText)).join("\n")}},y=(0,j.Z)(p.prototype,"projectDoc",[n],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),h=(0,j.Z)(p.prototype,"projectUIState",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),u=(0,j.Z)(p.prototype,"nodeStyleManagmentFlow",[i],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),g=(0,j.Z)(p.prototype,"componentStyleManagementFlow",[r],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),S=(0,j.Z)(p.prototype,"projectClassManagementFlow",[d],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),m=(0,j.Z)(p.prototype,"elementRefProvider",[a],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),f=(0,j.Z)(p.prototype,"nodeSelectionFlow",[l],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),b=(0,j.Z)(p.prototype,"tailwindService",[c],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),p)},666505:function(e,t,s){s.d(t,{bZ:function(){return n},b7:function(){return o},ux:function(){return i},a6:function(){return r}});s(202784),s(930613),s(233475),s(890810),s(272761),s(975350),s(278702),s(592681);const n="* {\n  background-color: rgba(255, 255, 255, 0.2) !important;\n  filter: grayscale(1);\n  outline: 1px dashed #1e1e1e !important;\n  outline-offset: -1px !important;\n  color: #262626 !important;\n  background-blend-mode: darken;\n}\n",o=" * {\n  cursor: grab;\n}\n",i=e=>{const{renderingMode:t,tailwind:s,referencedStyles:n,textStyleTokens:o,cssClassesList:i,nodeId:d}=e,a=[];return Object.values(s||{}).forEach((e=>{"preview"!==t?r(e)&&a.push(e):a.push(e)})),Object.values(n||{}).filter((e=>{if("design-language-referenced"===e.content.mapType){const t=o[e.content.referenceId];if(!t)throw new Error("TextStyle is missing from the design token");a.push(t.identifier)}if("project-referenced"===e.content.mapType)return e;"component-referenced"===e.content.mapType&&"static"===e.content.content.type&&a.push(...e.content.content.content.split(" "))})).forEach((e=>{var t;const s=i[e.content.referenceId];!s||!("disabledInNodes"in s)||null!==(t=s.disabledInNodes)&&void 0!==t&&t[d]||(s.linkedTextStyles&&Object.keys(s.linkedTextStyles).forEach((e=>{const t=o[e];a.push(t.identifier)})),a.push(s.getIdentifier()))})),a},r=e=>1===e.split(":").length}}]);
